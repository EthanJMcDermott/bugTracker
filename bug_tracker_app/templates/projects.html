<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300&family=Roboto:wght@300&display=swap');
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/f6fbc72d0a.js" crossorigin="anonymous"></script>
    <title>Document</title>
</head>
<body>
    <script>
        $(document).ready(function(){
            $("#mobile-nav-btn").click(function() {
                $("#mobile-nav").toggle();
            })
        })
    </script>
    <div class="container">
    <div id=cover></div>
        <div class="header">
            <a href="/">Home</a>
            <a href="/projects">Projects</a>
            <a href="/tickets">Tickets</a>
            {% if request.session.role == 3 %}
            <a href="/admin">Admin</a>
            {% endif %}
            <a href="/logout">Logout</a>
            <button id="mobile-nav-btn">
                <i class="fas fa-bars fa-2x"></i>
            </button>
        </div>
        <div id="mobile-nav">
            <a href="/">Home</a>
            <a href="/projects">Projects</a>
            <a href="/tickets">Tickets</a>
            {% if request.session.role == 3 %}
            <a href="/admin">Admin</a>
            {% endif %}
            <a href="/logout">Logout</a>
        </div>
        <div class="sub-header">
            <h2>My Projects</h2>
        </div>
        <div class="add-project-container">
            {% if request.session.role in admin %}
            <button class="open-form" id="openForm" onclick="openForm()">Create New Project</button>
            {% endif %}
            <div class="add-project" id="addProject">
                <form action="/projects/add" method="post">
                    {% csrf_token %}
                    <label for="title">Project Title: </label>
                    <input type="text" name="title">
                    <label for="description">Project Description</label>
                    <textarea name="description" cols="30" rows="10"></textarea>
                    <label for="project_manager">Select Project Manager</label>
                    <select name="project_manager">
                        <option value=""></option>
                        {% for user in users %}
                        <option value="{{ user.id }}">{{ user.first_name }} {{ user.last_name }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="submit">Create</button>
                </form>
                <button class="close-form" onclick="closeForm()">Close</button>
            </div>
        </div>
        <div class="projects">
            {% for project in projects %}
            {% if this_user in project.users.all or this_user.role == 3%}
            <div class="individual-project box-shadow">
                <h3>{{ project.title }}</h3>
                <h4>Project Manager | {{ project.project_manager.first_name }} {{ project.project_manager.last_name }}</h4>
                <p class="project-description">{{ project.description }}</p>
                <p class="project-footer">Created on: {{ project.created_at }} <br>
                Created by: {{ project.created_by.first_name }} {{ project.created_by.last_name }} </p>
                <a href="/projects/{{ project.id }}">View Project</a>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    <script>
        function openForm() {
          document.getElementById("addProject").style.display = "block";
        //   document.getElementById("openForm").style.display = "none"
          document.getElementById("cover").style.display="block"
        }
        
        function closeForm() {
          document.getElementById("cover").style.display="none"
          document.getElementById("addProject").style.display = "none";
        //   document.getElementById("openForm").style.display = "block"
        }
    </script>
</body>
</html>