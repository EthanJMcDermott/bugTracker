<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300&family=Roboto:wght@300&display=swap');
    </style>
    <title>Document</title>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="/">Home</a>
            <a href="/projects">Projects</a>
            <a href="/tickets">Tickets</a>
            {% if request.session.role == 3 %}
            <a href="/admin">Admin</a>
            {% endif %}
            <a href="/logout">Logout</a>
        </div>
        <div class="sub-header">
            <h2>{{ ticket.title }}</h2>
        </div>
        <div class="tickets-comments">
            <div class="individual-project box-shadow">
                <h2>{{ ticket.title }}</h2>
                <p>ID {{ ticket.id }}</p>
                <p>Priority: {{ ticket.get_priority_display }}</p>
                <p>{{ ticket.description }}</p>
                <p>Assigned To: 
                    {% if ticket.user == None %}
                        Unassigned
                    {% else %}
                        {{ ticket.user.first_name }} {{ ticket.user.last_name }}
                    {% endif %}
                </p>
                <p>Created at: {{ ticket.created_at }}</p>
                <p>Updated at: {{ ticket.updated_at }}</p>
                {% if ticket.status == 2 %}
                {% if request.session.user_id == ticket.user.id %}
                <form action="/tickets/{{ ticket.id }}/submit" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="ticket-status" value="3">
                    <button id="ticket-submit" type="submit">Submit for Review</button>
                </form>
                {% endif %}
                {% endif %}
                {% if ticket.status == 3 %}
                <h3>Ticket is under review</h3>
                {% elif ticket.status == 4 %}
                <h3>Ticket is resolved</h3>
                {% endif %}
                {% if ticket.project.project_manager.id == request.session.user_id and ticket.status == 3%}
                <form action="/tickets/{{ ticket.id }}/resolve" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="ticket-status" value="4">
                    <button id="ticket-resolve" type="submit">Approve (Close Ticket)</button>
                </form>
                {% endif %}
                {% if request.session.user_id == ticket.project.project_manager.id %}
                <form action="/tickets/{{ ticket.id }}/delete">
                    {% csrf_token %}
                    <input type="hidden" value="{{ ticket.id }}" name="ticketid">
                    <button id="ticket-delete" type="submit">DELETE</button>
                </form>
                {% endif %}
            </div>
            <div class="comments">
                <ul>
                    {% for comment in comments %}
                    <li></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="view-tickets-table">
            <h2>I want to view...</h2>
            <div>
                {% if ticket.user == None %}
                    <button class="ticket-button">Unassigned Tickets</button>'
                {% else %}
                    <button class="ticket-button">Tickets Assigned to {{ ticket.user.first_name }} {{ ticket.user.last_name }}</button>
                {% endif %}
                <button class="ticket-button">Tickets This user has resolved</button>
                <form action="/projects/{{ ticket.project.id }}">
                    <button type="submit" class="ticket-button">All tickets from this project</button>
                </form>
               
            </div>
        </div>
    </div>    
</body>
</html>